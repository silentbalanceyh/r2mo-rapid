# OAuth2 Authorization Server 配置示例

security:
  # 基础安全配置
  basic:
    enabled: true
    realm: "R2MO Realm"

  # JWT 配置（如果 OAuth2 使用 JWT，可复用此配置）
  jwt:
    enabled: false  # OAuth2 启用后，建议禁用旧的 JWT
    issuer: "https://auth.example.com"
    expiredAt: 30m
    refreshAt: 7d
    secretKey: "4KEBF72K14MH2Z6SWTQSMBU2"

  # OAuth2 配置
  oauth2:
    enabled: true
    mode: JWT  # JWT 或 OIDC
    issuer: "https://auth.example.com"

    # Token 配置
    accessTokenAt: 30m      # 访问令牌过期时间
    refreshTokenAt: 7d      # 刷新令牌过期时间
    reuseRefreshToken: true # 是否重用刷新令牌

    # Resource Server 配置
    resourceEnabled: true   # 是否启用资源服务器保护

    # OIDC 配置
    oidc:
      userClaims: true      # 是否在 UserInfo 中包含自定义字段

    # 固定客户端配置
    clients:
      # 示例1：标准授权码模式客户端
      - clientId: demo-client
        clientSecret: demo-secret  # 将自动加密
        clientName: Demo Application
        authMethods:
          - client_secret_basic
        grantTypes:
          - authorization_code
          - refresh_token
        redirectUris:
          - http://localhost:8080/login/oauth2/code/demo
          - http://localhost:8080/authorized
        postLogoutRedirectUris:
          - http://localhost:8080/logged-out
        scopes:
          - openid
          - profile
          - email
          - api.read
          - api.write
        requireConsent: true

      # 示例2：客户端凭证模式（服务间调用）
      - clientId: service-client
        clientSecret: service-secret
        clientName: Service Application
        authMethods:
          - client_secret_post
        grantTypes:
          - client_credentials
        scopes:
          - api.read
          - api.write
        requireConsent: false

      # 示例3：密码模式（不推荐，仅用于可信客户端）
      - clientId: trusted-client
        clientSecret: trusted-secret
        clientName: Trusted Application
        authMethods:
          - client_secret_basic
        grantTypes:
          - password
          - refresh_token
        scopes:
          - openid
          - profile
          - api.read
        requireConsent: false

---
# 多租户配置示例（可选）
# 如果需要多租户支持，可在客户端表中添加 tenant_id 字段
# 并在查询时添加租户过滤条件

---
# 数据库配置（必需）
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/oauth2_db?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai
    username: root
    password: password
    driver-class-name: com.mysql.cj.jdbc.Driver

  # JPA 配置（可选）
  jpa:
    hibernate:
      ddl-auto: none  # 使用 SQL 脚本初始化，不要自动建表
    show-sql: true

